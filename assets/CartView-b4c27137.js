import{_ as f,o as d,c,d as t,F as m,e as $,f as u,t as h,a as _,g as I,v as C}from"./index-602dab7e.js";const{VITE_API_URL:l,VITE_API_PATH:n}={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"59487@@",BASE_URL:"/vite-test/",MODE:"production",DEV:!1,PROD:!0},x={data(){return{loadingStatus:{loadingItem:""},products:[],product:{},form:{user:{name:"",email:"",tel:"",address:""},message:""},cart:{}}},methods:{getProducts(){const s=`${l}/api/${n}/products`;this.$http.get(s).then(e=>{this.products=e.data.products}).catch(e=>{alert(e.res.data.message)})},getProduct(s){const e=`${l}/api/${n}/product/${s}`;this.loadingStatus.loadingItem=s,this.$http.get(e).then(a=>{this.loadingStatus.loadingItem="",this.product=a.data.product,this.$refs.userProductModal.openModal()}).catch(a=>{alert(a.res.data.message)})},addToCart(s,e=1){const a=`${l}/api/${n}/cart`;this.loadingStatus.loadingItem=s;const i={product_id:s,qty:e};this.$refs.userProductModal.hideModal(),this.$http.post(a,{data:i}).then(o=>{alert(o.data.message),this.loadingStatus.loadingItem="",this.getCart()}).catch(o=>{alert(o.res.data.message)})},updateCart(s){this.loadingStatus.loadingItem=s.id;const e=`${l}/api/${n}/cart/${s.id}`,a={product_id:s.product_id,qty:s.qty};this.$http.put(e,{data:a}).then(i=>{this.loadingStatus.loadingItem="",alert(i.data.message),this.getCart()}).catch(i=>{this.loadingStatus.loadingItem="",alert(i.response.data.message)})},deleteAllCarts(){const s=`${l}/api/${n}/carts`;this.$http.delete(s).then(e=>{alert(e.data.message),this.getCart()}).catch(e=>{alert(e.response.data.message)})},getCart(){const s=`${l}/api/${n}/cart`;this.$http.get(s).then(e=>{this.cart=e.data.data}).catch(e=>{alert(e.res.data.message)})},removeCartItem(s){const e=`${l}/api/${n}/cart/${s}`;this.loadingStatus.loadingItem=s,this.$http.delete(e).then(a=>{alert(a.data.message),this.loadingStatus.loadingItem="",this.getCart()}).catch(a=>{alert(a.res.data.message)})},createOrder(){const s=`${l}/api/${n}/order`,e=this.form;this.$http.post(s,{data:e}).then(a=>{alert(a.data.message),this.$refs.form.resetForm(),this.message="",this.getCart()}).catch(a=>{alert(a.response.data.message)})}},mounted(){this.getProducts(),this.getCart()}},b={class:"text-end"},y={class:"table align-middle"},v=t("thead",null,[t("tr",null,[t("th"),t("th",null,"品名"),t("th",{style:{width:"150px"}},"數量/單位"),t("th",null,"單價")])],-1),S=["onClick"],P={key:0,class:"fas fa-spinner fa-pulse"},k={key:0,class:"text-success"},V={class:"input-group input-group-sm"},A={class:"input-group mb-3"},T=["onUpdate:modelValue","onBlur"],E={class:"input-group-text",id:"basic-addon2"},B={class:"text-end"},M={key:0,class:"text-success"},D=t("td",{colspan:"3",class:"text-end"},"總計",-1),U={class:"text-end"},q={key:0},L=t("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),R={class:"text-end text-success"};function w(s,e,a,i,o,p){return d(),c(m,null,[t("div",b,[t("button",{class:"btn btn-outline-danger",type:"button",onClick:e[0]||(e[0]=(...r)=>p.deleteAllCarts&&p.deleteAllCarts(...r))}," 清空購物車 ")]),t("table",y,[v,t("tbody",null,[o.cart.carts?(d(!0),c(m,{key:0},$(o.cart.carts,r=>(d(),c("tr",{key:r.id},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:g=>p.removeCartItem(r.id)},[o.loadingStatus.loadingItem===r.id?(d(),c("i",P)):u("",!0),_(" x ")],8,S)]),t("td",null,[_(h(r.product.title)+" ",1),r.coupon?(d(),c("div",k,"已套用優惠券")):u("",!0)]),t("td",null,[t("div",V,[t("div",A,[I(t("input",{"onUpdate:modelValue":g=>r.qty=g,onBlur:g=>p.updateCart(r),min:"1",type:"number",class:"form-control"},null,40,T),[[C,r.qty,void 0,{number:!0}]]),t("span",E,h(r.product.unit),1)])])]),t("td",B,[o.cart.final_total!==o.cart.total?(d(),c("small",M,"折扣價：")):u("",!0),_(" "+h(r.final_total),1)])]))),128)):u("",!0)]),t("tfoot",null,[t("tr",null,[D,t("td",U,h(o.cart.total),1)]),o.cart.final_total!==o.cart.total?(d(),c("tr",q,[L,t("td",R,h(o.cart.final_total),1)])):u("",!0)])])],64)}const N=f(x,[["render",w]]);export{N as default};
